@page "/weather"
@inject HttpClient Http
@using System.Net.Http.Json
@using System

<PageTitle>Weather</PageTitle>

<h1>Enter Latitude and Longitude</h1>

<!-- Input form for Latitude and Longitude -->
<div>
    <label>Latitude:</label>
    <input @bind="latitude" />
</div>
<div>
    <label>Longitude:</label>
    <input @bind="longitude" />
</div>
<button @onclick="GetWeatherData">Get Weather</button>

<p><em>Loading...</em></p>

@if (weatherInfo != null)
{
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Temp. (F)</th>
                <th>Summary</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>@DateTimeOffset.FromUnixTimeSeconds(weatherInfo.Current.Dt).DateTime.ToShortDateString()</td>
                <td>@weatherInfo.Lat</td>
                <td>@weatherInfo.Lon</td>
                <td>@((weatherInfo.Current.Temp - 273.15) * 9 / 5 + 32)</td>
                <td>@(weatherInfo.Daily.Length > 0 ? weatherInfo.Daily[0].Summary : weatherInfo.Current.Weather[0].Description)</td>
            </tr>
        </tbody>
    </table>
}

@code {
    private WeatherInfo? weatherInfo;
    private double latitude;
    private double longitude;

    // Method to handle the button click and fetch weather data
    private async Task GetWeatherData()
    {
        var url = $"https://localhost:5248/api/weather/forecast?lat={latitude}&lon={longitude}";
        weatherInfo = await Http.GetFromJsonAsync<WeatherInfo>(url);
    }

    // WeatherInfo class that matches your JSON structure
    public class WeatherInfo
    {
        public double Lat { get; set; }
        public double Lon { get; set; }
        public CurrentWeather Current { get; set; }
        public DailyWeather[] Daily { get; set; }
    }

    public class CurrentWeather
    {
        public double Temp { get; set; }
        public long Dt { get; set; }
        public WeatherCondition[] Weather { get; set; }
    }

    public class DailyWeather
    {
        public string Summary { get; set; }
    }

    public class WeatherCondition
    {
        public string Description { get; set; }
    }
}
